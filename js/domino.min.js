/* domino.js - a JS fast dashboard prototyping framework - Version: 1.21 - Author:  Alexis Jacomy, Linkfluence - License: MIT */
(function(N,f){function da(){O.strict?u.apply(this,arguments):na.apply(this,arguments)}function u(){var a="",f;for(f in arguments)a+=(a?" ":"")+arguments[f];throw Error(a);}function na(){O.verbose&&ha.apply(this,arguments)}function ha(){var a=[],f;for(f in arguments)a.push(arguments[f]);O.displayTime&&a.unshift(("00000000"+((new Date).getTime()-oa)).substr(-8));console&&console.log instanceof Function&&console.log.apply(console,a)}var ma=/^[a-zA-Z_$-][a-zA-Z_$0-9-]*$/,oa=new Date,X={};if(N.domino)throw Error("domino already exists");
N.domino=function(a,d){function i(b){var b=b||{},g={getEvents:D,getLabel:pa,expand:S,warn:r,log:E,die:q,get:p};b.full?(g.kill=W,g.update=e,g.addModule=c,g.request=z,g.settings=w,g.dispatchEvent=function(b,g){x({events:K.getEvent(b,g)});return this}):(b.request&&(Object.defineProperty(g,"_services",{value:[]}),g.request=function(b,g){var a,h;if(k.check("string",b)){h={service:b};for(a in g||{})h[a]=g[a];this._services.push(h)}else if(k.check("object",b))this._services.push(b);else if(k.check("array",
b))for(a in b)this._services.push(b[a]);return this}),b.dispatchEvent&&(Object.defineProperty(g,"_events",{value:[]}),g.dispatchEvent=function(b,g){this._events.push({type:b,data:g});return this}));return g}function o(b){b.request!==f&&(b.request=function(){q("This method is no longer available.");return this});b.dispatchEvent!==f&&(b.dispatchEvent=function(){q("This method is no longer available.");return this})}function m(b,g){var a,ia,l=g||{};b===f&&q("Property name not specified");"string"!==
k.get(b)&&q("The property name must be a string");P[b]!==f&&q('Property "'+b+'" already exists');ea[b]!==f&&q('"'+b+'" can not be used to name a property');b.match(ma)||q("Property name not valid ("+ma+")");ja[b]={};for(ia in l)ja[b][ia]=l[ia];N[b]=l.label||b;l.type!==f&&(k.isValid(l.type)?Q[b]=l.type:r('Property "'+b+'": Type not valid'));l.setter!==f&&("function"!==k.get(l.setter)?r('Property "'+b+'": Setter is not a function'):(F[b]=l.setter,ka[b]=!0));F[b]=F[b]||function(g){if(k.deepScalar(Q[b])&&
k.compare(g,P[b],Q[b]))return!1;Q[b]&&!k.check(Q[b],g)?r('Property "'+b+'": Wrong type error'):P[b]=g;return!0};l.getter!==f&&("function"!==k.get(l.getter)?r('Property "'+b+'": Getter is not a function'):(G[b]=l.getter,la[b]=!0));G[b]=G[b]||function(){return P[b]};if(l.value!==f||Q[b])l.value!==f?Y(b,l.value):E('Property "'+b+'": Initial value is missing');if(l.triggers!==f)for(a in!k.check("array|string",l.triggers)&&r('Property "'+b+'": Events ("triggers") must be specified in an array or separated by spaces in a string'),
R[b]=y.array(l.triggers),R[b]||[])T[R[b][a]]=T[R[b][a]]||[],T[R[b][a]].push(b);l.dispatch!==f&&(!k.check("array|string",l.dispatch)?r('Property "'+b+'": Events ("dispatch") must be specified in an array or separated by spaces in a string'):Z[b]=y.array(l.dispatch));return K}function j(b){var g=b||{};(g.id===f||"string"!==k.get(g.id))&&q("The service id is not indicated.");k.check("function|string",g.url)||q("The service URL is not valid.");$[g.id]!==f&&q('The service "'+g.id+'" already exists.');
$[g.id]=function(b){E('Calling service "'+g.id+'".');var a=b||{},l=a.shortcuts||{},h={contentType:a.contentType||g.contentType,dataType:a.dataType||g.dataType,type:(a.type||g.type||"GET").toString().toUpperCase(),data:a.data!==f?a.data:"function"===k.get(g.data)?g.data.call(i(),a):g.data,url:"function"===k.get(g.url)?g.url.call(i(),a):g.url,error:function(b,H){K.dispatchEvent("domino.ajaxFailed");var e=a.error||g.error;E('Loading service "'+g.id+'" failed with message "'+b+'" and status '+H.status+
".");"function"===k.get(e)&&A(e,{parameters:[b,H,a],loop:a.loop||x,scope:{request:!0,dispatchEvent:!0}})}},e,L,n;L=w("shortcutPrefix");var b=RegExp(L+"(\\w+)","g"),c=RegExp("^"+L+"(\\w+)$"),p=null,d;for("string"!==k.get(h.url)&&q('The URL is no more a string (typed "'+k.get(h.url)+'")');(d=h.url.match(b))&&h.url!==p;)for(e in p=h.url,d)L=S(d[e].match(c)[1],l),h.url=h.url.replace(RegExp(d[e],"g"),L);e=!0;"string"===k.get(h.data)&&h.data.match(c)&&(h.data=S(h.data.match(c)[1],l));if("object"===k.get(h.data))for(;e;)for(n in e=
!1,h.data)"string"===k.get(h.data[n])&&h.data[n].match(c)&&(h.data[n]=S(h.data[n].match(c)[1],l),e=!0);h.success=function(b){var H,e,L,d,p={},m=[],B=[],q={},z=!1,j=a.path||g.path,B=a.setter||g.setter,Y=a.success||g.success;d=a.expect||g.expect||w("expect");if("function"===k.get(d)&&!d.call(i(),b,a,g))h.error.call(this,"Unexpected data received.",this.xhr());else{E('Service "'+g.id+'" successfull.');"string"===k.get(B)&&B.match(c)&&(B=S(B.match(c)[1],l));"string"===k.get(j)&&j.match(c)&&(j=S(j.match(c)[1],
l));d=b;(j||"").match(/^(?:\w+\.)*\w+$/)?e=k.get(j,"string")?j.split("."):f:"string"===k.get(j)&&r('Path "'+j+'" does not match RegExp /^(?:\\w+\\.)*\\w+$/');if(e)for(H in e)d=d[e[H]],d===f&&r('Wrong path "'+j+'" for service "'+g.id+'".');e=y.array(g.events);for(H in e)p[e[H]]=1,z=!0;e=y.array(a.events);for(H in e)p[e[H]]=1,z=!0;B&&F[B]&&d!==f&&(q[B]=d,z=!0);if("function"===k.get(Y)){b=A(Y,{parameters:[b,a],scope:{request:!0,dispatchEvent:!0}});e=y.array(b.events);for(n in e)z=!0,p[e[n].type]=1;for(n in b.update)q[n]===
f?(q[n]=b.update[n],z=!0):r('The key "'+n+'" is nor a method neither a property.');if((b.services||[]).length)z=!0,m=m.concat(b.services);o(b)}B=[];for(L in p)B.push(K.getEvent(L));z&&(a.loop||x)({events:B,update:q,services:m})}};e=a.before||g.before;null!=e&&"function"===k.get(e)&&A(e,{parameters:[a],loop:!0,scope:{dispatchEvent:!0}});a.abort&&fa[g.id]&&fa[g.id].abort();fa[g.id]=y.ajax(h)};return K}function c(b,g){var a,e={},l={},h,c,d;b===f&&q("Module class not specified.");"function"!==k.get(b)&&
q("First parameter must be a function.");b.apply(e,(g||[]).concat(i()));h=e.triggers||{};for(d in h.events||{})U[d]=U[d]||[],U[d].push(h.events[d]);for(c in h.properties||{}){for(a in Z[c]||[])V[c]=V[c]||[],V[c].push(h.properties[c]);G[c]!==f&&(p(c),A(h.properties[c],{parameters:[i()]}))}for(d in T||{})l[d]=1;for(d in I||{})l[d]=1;for(d in M||{})l[d]=1;for(d in l)e.addEventListener(d,n);aa.push(e);return e}function e(b,g){var a="object"===typeof b&&1===arguments.length?b||{}:{};"string"===typeof b&&
(a[b]=g);x({update:a});return this}function n(b){x({events:[b],emitter:b.target})}function x(b){var g,a,e,l,h,d,c,n=!1,p=[],k=[],m=[],b=b||{},j={},s={};b.loop=(+b.loop||0)+1;b.loopId=b.loopId||++da;w("maxDepth")&&b.loop>w("maxDepth")&&q("Loop "+b.loopId+" exceeds maximum depth ("+w("maxDepth")+")");var t=y.array(b.events);c=y.array(b.services);var u=b.update||{};if(w("verbose")){E("Iteration "+b.loop+" (loop "+b.loopId+")");if(t.length){h=[];for(a in t)h.push(t[a].type);E(" -> Events: ",h)}if(c.length){h=
[];for(a in c)h.push("string"===typeof c[a]?c[a]:c[a].service);E(" -> Services: ",h)}h=[];for(a in u)h.push(a);h.length&&E(" -> Update: ",h)}for(g in u)if(F[g]===f)r('The property "'+g+'" is not referenced.');else if(h=Y(g,u[g])||!!b.force){for(a in V[g])A(V[g][a],{parameters:[i(),{property:g,emitter:b.emitter}]});for(a in Z[g]||[])h=Z[g][a],j[h]=K.getEvent(h)}if(c.length)if(w("mergeRequests"))z(c);else for(e in c)z(c[e]);for(a in t){d=t[a];for(e in c=d.data||{},g=T[d.type]||[],g)c[g[e]]!==f&&(n=
!0,s[g[e]]=c[g[e]]);for(l in U[d.type])A(U[d.type][l],{parameters:[i(),d,b.emitter]});for(e in I[d.type]||[])if(0>p.indexOf(I[d.type][e])){p.push(I[d.type][e]);c=A(I[d.type][e],{parameters:[d],scope:{request:!0,dispatchEvent:!0}});g=y.array(c.events);for(l in g)j[g[l].type]=g[l];for(l in c.update)s[l]===f?(n=!0,s[l]=c.update[l]):r('The property "'+l+'" has already been updated in the current loop.');if((c.services||[]).length)n=!0,m=m.concat(c.services);o(c)}for(e in M[d.type]||[])h=M[d.type][e],
j[h]=K.getEvent(h)}for(d in j)K.dispatchEvent(d,j[d].data),k.push(j[d]),n=!0;n&&x({events:k,update:s,services:m,emitter:b.emitter,loopId:b.loopId,loop:b.loop})}function p(b){if(G[b]){if(la[b]){for(var a=[],e={},d=1,c=arguments.length;d<c;d++)a.push(arguments[d]);e[b]=P[b];a=A(G[b],{parameters:a,inputValues:e});return J(b)?y.clone(a.returned):a.returned}return J(b)?y.clone(G[b]()):G[b]()}r('Property "'+b+'" not referenced.')}function Y(b,a){if(F[b]){if(ka[b]){var e,d;e=[];d={};J(b)&&(a=y.clone(a));
d[b]=p(b);for(var c=1,h=arguments.length;c<h;c++)e.push(arguments[c]);d=A(F[b],{parameters:e,inputValues:d});(e="boolean"!==k.get(d.returned)||d.returned)&&(P[b]=d.update[b]);return e}return F[b].call(i(),J(b)?y.clone(a):a)}r('Property "'+b+'" not referenced.');return!1}function z(b,a){if(k.check("string",b))if($[b])$[b](a);else r('Service "'+b+'" not referenced.');else if(k.check("object",b))z(b.service,b);else if(k.check("array",b)){var a=a||{},e,d=b.length;if(a.merge!==f?a.merge:w("mergeRequests")){var c,
h,n=d,p=[];for(e=0;e<d;e++){if("string"===typeof b[e])c={service:b[e]};else for(h in c={},b[e])c[h]=b[e][h];(function(b){c.loop=function(a){p[b]=a;if(!--n){var e,g,c={update:{},events:[],services:[]};for(e=0;e<d;e++){a=p[e]||{};for(g in a.update||{})c.update[g]=a.update[g];c.events=c.events.concat(a.events||[]);c.services=c.services.concat(a.services||[])}x(c)}}})(e);z(c)}}else for(e=0,d=b.length;e<d;e++)z(b[e])}return this}function A(b,a){var e,c,d=a||{},h=i(d.scope);"function"!==k.get(b)&&q("The first parameter must be a function");
for(e in d.inputValues||{})h[e]=d.inputValues[e];c={returned:b.apply(h,d.parameters||[]),update:{},events:[],services:[]};null!=h._events&&!k.check("array",h._events)?r("Events must be stored in an array."):c.events=h._events;for(e in h)F[e]!==f?c.update[e]=h[e]:ea[e]===f&&r('The key "'+e+'" is not a method nor a property.');for(e in d.inputValues)c.update[e]=h[e];for(e in h._services)c.services[e]=h._services[e];if(d.loop){h=(c.services||[]).length||(c.events||[]).length;if(!h)for(e in c.update)h=
!0;h&&(k.check("function",d.loop)?d.loop:x)(c)}else return c}function pa(b){return N[b]}function D(b){return R[b]}function S(b){var a=b,e=(b||"").toString().match(RegExp("^"+w("shortcutPrefix")+"(\\w+)$"));e&&e.length&&(r("Prefix in expand() calls is deprecated."),a=e[1]);for(var e=1,c=arguments.length;e<c;e++)if((arguments[e]||{})[a]!==f)return arguments[e][a];if("function"===k.get(G[a]))return p(a);if("function"===k.get(ba[a]))return ba[a].call(i());r('The shortcut "',a,'" has not been recognized.');
return a}function J(b){b=(ja[b]||{}).clone;return b!==f?!!b:w("clone")}function W(){var b;E('Killing instance "'+C+'"');for(b in aa)aa[b].removeEventListener();ba=fa=$=M=I=V=U=Z=T=aa=ka=la=P=F=G=R=N=Q=aa=null;for(b in ca)delete ca[b];X[C]&&delete X[C]}function w(b,a){if("string"===typeof b&&1===arguments.length)return ga[b]!==f?ga[b]:O[b];var e="object"===typeof b&&1===arguments.length?b||{}:{};"string"===typeof b&&(e[b]=a);for(var c in e)e[c]!==f?ga[c]=e[c]:delete ga[c];return this}function r(){var b=
["["+(C||"domino")+"]"];w("strict")||b.push("WARNING");for(var a in arguments)b.push(arguments[a]);w("strict")?u.apply(this,b):w("verbose")&&ha.apply(this,b)}function q(){var b=["["+(C||"domino")+"]"],a;for(a in arguments)b.push(arguments[a]);u.apply(this,b)}function E(){var b=["["+(C||"domino")+"]"];if(w("verbose")){for(var a in arguments)b.push(arguments[a]);ha.apply(this,b)}}(function(){v.call(this);for(var b in v.prototype)this[b]=v.prototype[b]}).call(this);var K=this,y=s.utils,k=s.struct,ga=
{},ca,Q={},N={},R={},G={},F={},P={},ja={},la={},ka={},aa=[],da=0,T={},Z={},U={},V={},I={},M={},$={},fa={},ba={},ea={events:1,services:1,hacks:1};(function(){for(var b in Object.prototype)ea[b]=1;for(b in i({full:!0}))ea[b]=1})();ca=i({full:!0});var t={},C;"string"===k.get(a)?C=a:a!==f&&"object"===k.get(a)?t=a:d!==f&&"object"===k.get(d)&&(t=d);(C=t.name)&&(X[C]?q('An instance named "'+C+'" is already running.'):X[C]=ca);(function(){for(var b in t.properties||[])m(t.properties[b].id,t.properties[b]);
for(b in t.hacks||[]){var a=void 0,e=void 0,c=t.hacks[b]||{};c.triggers===f&&q("A hack requires at least one trigger to be bound");a=y.array(c.triggers);for(e in a)M[a[e]]=M[a[e]]||[],I[a[e]]=I[a[e]]||[],c.method&&I[a[e]].push(c.method),c.dispatch&&(M[a[e]]=M[a[e]].concat(y.array(c.dispatch)))}for(b in t.services||[])j(t.services[b]);for(b in t.shortcuts||[])a=t.shortcuts[b].id,e=t.shortcuts[b].method,a===f&&q("Shortcut ID not specified."),ba[a]&&q('Shortcut "'+a+'" already exists.'),e===f&&q("Shortcut method not specified."),
ba[a]=e})();return ca};var s=N.domino;s.utils={array:function(a,d){var f="string"===s.struct.get(a)?a.split(d||" "):"array"===s.struct.get(a)?a:[a],o=[],m;for(m in f)f[m]&&o.push(f[m]);return o},clone:function(a){if(!a)return a;var d,f;if("array"===J.get(a))for(f in d=[],a)d[f]=this.clone(a[f]);else if("date"===J.get(a))d=new Date(a.getTime());else if("object"===J.get(a))if(a.prototype)d=a;else{d={};for(var o in a)d[o]=this.clone(a[o])}else d=a;return d},ajax:function(a,d){"string"===typeof a?a={url:a,
ok:d}:"object"!==J.get(a)&&u("[domino.global] Invalid parameter given to AJAX");var f=a.type||"GET",o=a.url||"",m=a.contentType||"application/x-www-form-urlencoded",j=a.dataType||"json",c=new XMLHttpRequest,e,n,x;if(a.data){if("string"===typeof a.data)n=a.data;else if(/json/.test(m))n=JSON.stringify(a.data);else{n=[];for(x in a.data)n.push(encodeURIComponent(x)+"="+encodeURIComponent(a.data[x]));n=n.join("&")}/GET|DEL/i.test(f)&&(o+=/\?/.test(o)?"&"+n:"?"+n,n="")}c.onreadystatechange=function(){if(4==
c.readyState)if(e&&clearTimeout(e),/^2/.test(c.status)){n=c.responseText;if(/json/.test(j))try{n=JSON.parse(c.responseText)}catch(d){return a.error&&a.error("JSON parse error: "+d.message,c)}a.success&&a.success(n,c)}else{var f=+c.status?c.responseText:c.responseText.length?"Aborted: "+c.responseText:"Aborted";a.error&&a.error(f,c)}};c.open(f,o,!0);c.setRequestHeader("Content-Type",m);if(a.headers)for(x in a.headers)c.setRequestHeader(x,a.headers[x]);a.timeout&&(e=setTimeout(function(){c.onreadystatechange=
function(){};c.abort();a.error&&a.error&&a.error("timeout",c)},1E3*a.timeout));c.send(n);return c}};s.struct=function(){var a=["number","string","boolean","null","undefined"],d="Boolean,Number,String,Function,Array,Date,RegExp,Object".split(","),i={},o=["*"],m={},j;for(j in d){var c=d[j];o.push(c.toLowerCase());i["[object "+c+"]"]=c.toLowerCase()}return{add:function(a,c,d){var p,j,i,A,v,D;1===arguments.length?"object"===this.get(a)?(D=a,i=D.id,v=D.struct):u("[domino.global] If struct.add is called with one arguments, it has to be an object"):
2===arguments.length?("string"!==this.get(a)||!a?u("[domino.global] If struct.add is called with more than one arguments, the first one must be the string id"):i=a,v=c):u("[domino.global] struct.add has to be called with one or three arguments");("string"!==this.get(i)||0===i.length)&&u("[domino.global] A structure requires an string id");m[i]!==f&&"proto"!==m[i]&&u('[domino.global] The structure "'+i+'" already exists');m[i]=1;j=s.utils.array((D||{}).proto);A={};for(p in j)m[j[p]]===f&&(m[j[p]]=
1,A[j[p]]=1);"function"!==this.get(v)&&!this.isValid(v)&&u('[domino.global] A structure requires a valid "structure" property describing the structure. It can be a valid structure or a function that test if an object matches the structure.');~o.indexOf(i)&&u('[domino.global] "'+i+'" is a reserved structure name');m[i]=D===f?{id:i,struct:v}:{};if(D!==f)for(p in D)m[i][p]=D[p];for(p in A)p!==i&&delete m[p]},get:function(a){return null==a?""+a:i[Object.prototype.toString.call(a)]||"object"},check:function(a,
c){var d,i,j=this.get(c);if("string"===this.get(a)){d=a.replace(/^\?/,"").split(/\|/);for(i in d)if(0>o.indexOf(d[i])&&m[d[i]]===f)return da("[domino.global] Invalid type"),!1;if(null==c)return!!a.match(/^\?/,"");a.replace(/^\?/,"");for(i in d)if(m[d[i]]&&("function"===this.get(m[d[i]].struct)&&!0===m[d[i]].struct(c)||this.check(m[d[i]].struct,c)))return!0;return!(!~d.indexOf("*")&&!~d.indexOf(j))}if("object"===this.get(a)){if("object"!==j)return!1;for(d in a)if(!this.check(a[d],c[d]))return!1;for(d in c)if(a[d]===
f)return!1;return!0}if("array"===this.get(a)){if("array"!==j)return!1;if(1!==a.length)return da("[domino.global] Invalid type"),!1;for(d in c)if(!this.check(a[0],c[d]))return!1;return!0}return!1},deepScalar:function(e){var c;if("string"===this.get(e)){e=e.replace(/^\?/,"").split(/\|/);for(c in e)if(0>a.indexOf(e[c]))return!1;return!0}if(this.check("object|array",e)){for(c in e)if(!this.deepScalar(e[c]))return!1;return!0}return!1},compare:function(a,c,d){this.get(a);this.get(c);var f;if(!this.deepScalar(d)||
!this.check(d,a)||!this.check(d,c))return!1;if("string"===this.get(d))return a===c;if("object"===this.get(d)){for(f in d)if(!this.compare(a[f],c[f],d[f]))return!1;return!0}if("array"===this.get(d)){if(a.length!==c.length)return!1;var i=a.length;for(f=0;f<i;f++)if(!this.compare(a[f],c[f],d[0]))return!1;return!0}return!1},isValid:function(a){var c,d;if("string"===this.get(a)){a=a.replace(/^\?/,"").split(/\|/);for(d in a)if(0>o.indexOf(a[d])&&m[a[d]]===f)return!1;return!0}if("object"===this.get(a)){for(c in a)if(!this.isValid(a[c]))return!1;
return!0}return"array"===this.get(a)?1===a.length?this.isValid(a[0]):!1:!1}}}();var W=s.utils,J=s.struct,O={maxDepth:0,strict:!1,verbose:!1,displayTime:!1,shortcutPrefix:":",mergeRequests:!0,clone:!1};s.settings=function(a,d){if("string"===typeof a&&1===arguments.length)return O[a];var i="object"===typeof a&&1===arguments.length?a||{}:{};"string"===typeof a&&(i[a]=d);for(var o in i)i[o]!==f?O[o]=i[o]:delete O[o];return this};s.instances=function(a){if(arguments.length)return X[a];u("[domino.global] You need to indicate a name to get the instance.")};
s.EventDispatcher=function(){Object.defineProperty(this,"_handlers",{value:{}})};var v=s.EventDispatcher;v.prototype.addEventListener=function(a,d){if(arguments.length)if(1===arguments.length&&"object"===W.type.get(arguments[0]))for(a in arguments[0])this.addEventListener(a,arguments[0][a]);else if(1<arguments.length){var f,a=arguments[0],d=arguments[1],o=W.array(a),m;for(m in o)f=o[m],this._handlers[f]||(this._handlers[f]=[]),this._handlers[f].push({handler:d})}return this};v.prototype.removeEventListener=
function(a,d){var f,o,m,j,c=W.array(a);if(!arguments.length){for(f in this._handlers)delete this._handlers[f];return this}if(d)for(f in c){j=c[f];if(this._handlers[j]){m=[];for(o in this._handlers[j])this._handlers[j][o].handler!==d&&m.push(this._handlers[j][o]);this._handlers[j]=m}this._handlers[j]&&0===this._handlers[j].length&&delete this._handlers[j]}else for(f in c)delete this._handlers[c[f]];return this};v.prototype.dispatchEvent=function(a,d){var i,o,m,j,c,e=W.array(a),d=d===f?{}:d;for(i in e)if(c=
e[i],this._handlers[c]){j=this.getEvent(c,d);m=[];for(o in this._handlers[c])this._handlers[c][o].handler(j),this._handlers[c][o].one||m.push(this._handlers[c][o]);this._handlers[c]=m}return this};v.prototype.getEvent=function(a,d){return{type:a,data:d||{},target:this}};s.module=function(){v.call(this);for(var a in v.prototype)this[a]=v.prototype[a];this.triggers={properties:{},events:{}}}})(window);
